# docker-rpi-traefik

Traefik Docker image based on Alpine for the Raspberry Pi.

[Traefik](https://traefik.io/) is a modern HTTP reverse proxy and load balancer that makes deploying microservices easy.


## Run

Given the docker image with name `jriguera/traefik`:

```
docker run -ti -p 8080:80 -p 8081:8080 -v $(pwd)/config:/config -e DOMAIN=localhost -e DOMAIN_ROUTE_DOCKERS=true -v /var/run/docker.sock:/var/run/docker.sock  jriguera/traefik
```

By default, API and metrics (Prometheus exporter) are listening in port 8080,
and TLS configuration for HTTPS is not autogenerated unless you provide let's
encryt `ACME_*` environment variables. The password for API endpoint is
autogenerated if not provided in `config/admin.password`

`$CONFIGDIR_DYNAMIC` is pointing internally to `/config`, `$CONFIGDIR_STATIC`
points to `/etc/traefik`. Also, if docker socket is not passed to the container,
it will disable docker and traefik will use only dynamic configuration files.

With `$DOMAIN_ROUTE_DOCKERS` (default to false), all docker containers with
exposed ports will be automatically routed via traefik on:
`http://<container-name>.$DOMAIN`

Remember you can setup a lot of environment variables for traefik and and also use
docker labels to extend the configuration!: https://docs.traefik.io/getting-started/configuration-overview/#the-static-configuration

If you are not happy with the autogenerated values you can provide
a configuration file as a docker volume in `/etc/traefik/traefik.yml` (or `.toml`)

Environment variables and their default values for autogenerated configuration.

```
DOMAIN="${DOMAIN:-localhost}"
DOMAIN_ROUTE_DOCKERS="${DOMAIN_ROUTE_DOCKERS:-false}"
ADMIN_HOST="${ADMIN_HOST:-admin.$DOMAIN}"
ADMIN_AUTH_USER="${ADMIN_AUTH_USER:-admin}"
ADMIN_AUTH_PASSWORD="${ADMIN_AUTH_PASSWORD:-}"
ADMIN_CONFIGFILE="${ADMIN_CONFIGFILE:-$CONFIGDIR_DYNAMIC/api.yml}"
ADMIN_PROMETHEUS="${ADMIN_PROMETHEUS:-1}"
ADMIN_PORT="${ADMIN_PORT:-$PORT_API}"

ACME_JSON="${ACME_JSON:-$CONFIGDIR_DYNAMIC/acme/letsencrypt.json}"
ACME_EMAIL="${ACME_EMAIL:-}"

PORT_HTTP="${PORT_HTTP:-80}"
PORT_HTTPS="${PORT_HTTPS:-443}"
```

## Develop and test builds

Just type:

```
./docker-build.sh
```

### Create final release and publish to Docker Hub

```
create-publish-release.sh
```

# Author

Jose Riguera, 2019 `<jriguera@gmail.com>`

